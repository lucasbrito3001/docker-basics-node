<!DOCTYPE html>
<html>
<head>
  <title>install</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "aws/install";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>install</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-meta">#!/bin/sh
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Copyright 2012-2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You
may not use this file except in compliance with the License. A copy of
the License is located at</p>
<pre><code>http://aws.amazon.com/apache2.0/
</code></pre>
<p>or in the &quot;license&quot; file accompanying this file. This file is
distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
ANY KIND, either express or implied. See the License for the specific
language governing permissions and limitations under the License.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">usage</span></span>() {
  cat 1&gt;&amp;2 &lt;&lt;EOF
Installs the AWS CLI v2

USAGE:
    install [FLAGS] [OPTIONS]

FLAGS:
    -u, --update              Updates the AWS CLI v2 <span class="hljs-keyword">if</span> a different version
                              is previously installed. By default, this script
                              will not update the AWS CLI <span class="hljs-keyword">if</span> a previous
                              installation is detected.

    -h, --<span class="hljs-built_in">help</span>                Prints <span class="hljs-built_in">help</span> information

OPTIONS:
    -i, --install-dir &lt;path&gt;  The directory to install the AWS CLI v2. By
                              default, this directory is: /usr/<span class="hljs-built_in">local</span>/aws-cli

    -b, --bin-dir &lt;path&gt;      The directory to store symlinks to executables
                              <span class="hljs-keyword">for</span> the AWS CLI v2. By default, the directory
                              used is: /usr/<span class="hljs-built_in">local</span>/bin
EOF
}

<span class="hljs-function"><span class="hljs-title">parse_commandline</span></span>() {
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">test</span> <span class="hljs-variable">$#</span> -gt 0
  <span class="hljs-keyword">do</span>
    key=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$key</span>"</span> <span class="hljs-keyword">in</span>
	  -i|--install-dir)
	    PARSED_INSTALL_DIR=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
		<span class="hljs-built_in">shift</span>
	   ;;
	  -b|--bin-dir)
	    PARSED_BIN_DIR=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
		<span class="hljs-built_in">shift</span>
	   ;;
	  -u|--update)
	    PARSED_UPGRADE=<span class="hljs-string">"yes"</span>
	  ;;
	  -h|--<span class="hljs-built_in">help</span>)
	    usage
        <span class="hljs-built_in">exit</span> 0
	  ;;
	  *)
	   die <span class="hljs-string">"Got an unexpected argument: <span class="hljs-variable">$1</span>"</span>
	  ;;
    <span class="hljs-keyword">esac</span>
	<span class="hljs-built_in">shift</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">set_global_vars</span></span>() {
  ROOT_INSTALL_DIR=<span class="hljs-variable">${PARSED_INSTALL_DIR:-/usr/local/aws-cli}</span>
  BIN_DIR=<span class="hljs-variable">${PARSED_BIN_DIR:-/usr/local/bin}</span>
  UPGRADE=<span class="hljs-variable">${PARSED_UPGRADE:-no}</span>

  EXE_NAME=<span class="hljs-string">"aws"</span>
  COMPLETER_EXE_NAME=<span class="hljs-string">"aws_completer"</span>
  INSTALLER_DIR=<span class="hljs-string">"<span class="hljs-variable">$( cd "$( dirname "$0" )</span>"</span> &gt;/dev/null 2&gt;&amp;1 &amp;&amp; <span class="hljs-built_in">pwd</span> )<span class="hljs-string">"
  INSTALLER_DIST_DIR="</span><span class="hljs-variable">$INSTALLER_DIR</span>/dist<span class="hljs-string">"
  INSTALLER_EXE="</span><span class="hljs-variable">$INSTALLER_DIST_DIR</span>/<span class="hljs-variable">$EXE_NAME</span><span class="hljs-string">"
  AWS_EXE_VERSION=<span class="hljs-variable">$($INSTALLER_EXE --version | cut -d ' ' -f 1 | cut -d '/' -f 2)</span>

  INSTALL_DIR="</span><span class="hljs-variable">$ROOT_INSTALL_DIR</span>/v2/<span class="hljs-variable">$AWS_EXE_VERSION</span><span class="hljs-string">"
  INSTALL_DIR="</span><span class="hljs-variable">$INSTALL_DIR</span><span class="hljs-string">"
  INSTALL_DIST_DIR="</span><span class="hljs-variable">$INSTALL_DIR</span>/dist<span class="hljs-string">"
  INSTALL_BIN_DIR="</span><span class="hljs-variable">$INSTALL_DIR</span>/bin<span class="hljs-string">"
  INSTALL_AWS_EXE="</span><span class="hljs-variable">$INSTALL_BIN_DIR</span>/<span class="hljs-variable">$EXE_NAME</span><span class="hljs-string">"
  INSTALL_AWS_COMPLETER_EXE="</span><span class="hljs-variable">$INSTALL_BIN_DIR</span>/<span class="hljs-variable">$COMPLETER_EXE_NAME</span><span class="hljs-string">"

  CURRENT_INSTALL_DIR="</span><span class="hljs-variable">$ROOT_INSTALL_DIR</span>/v2/current<span class="hljs-string">"
  CURRENT_AWS_EXE="</span><span class="hljs-variable">$CURRENT_INSTALL_DIR</span>/bin/<span class="hljs-variable">$EXE_NAME</span><span class="hljs-string">"
  CURRENT_AWS_COMPLETER_EXE="</span><span class="hljs-variable">$CURRENT_INSTALL_DIR</span>/bin/<span class="hljs-variable">$COMPLETER_EXE_NAME</span><span class="hljs-string">"

  BIN_AWS_EXE="</span><span class="hljs-variable">$BIN_DIR</span>/<span class="hljs-variable">$EXE_NAME</span><span class="hljs-string">"
  BIN_AWS_COMPLETER_EXE="</span><span class="hljs-variable">$BIN_DIR</span>/<span class="hljs-variable">$COMPLETER_EXE_NAME</span><span class="hljs-string">"
}

create_install_dir() {
  mkdir -p "</span><span class="hljs-variable">$INSTALL_DIR</span><span class="hljs-string">" || exit 1
  {
    setup_install_dist &amp;&amp;
    setup_install_bin &amp;&amp;
    create_current_symlink
  } || {
    rm -rf "</span><span class="hljs-variable">$INSTALL_DIR</span><span class="hljs-string">"
    exit 1
  }
}

check_preexisting_install() {
  if [ -L "</span><span class="hljs-variable">$CURRENT_INSTALL_DIR</span><span class="hljs-string">" ] &amp;&amp; [ "</span><span class="hljs-variable">$UPGRADE</span><span class="hljs-string">" = "</span>no<span class="hljs-string">" ]
  then
    die "</span>Found preexisting AWS CLI installation: <span class="hljs-variable">$CURRENT_INSTALL_DIR</span>. Please rerun install script with --update flag.<span class="hljs-string">"
  fi
  if [ -d "</span><span class="hljs-variable">$INSTALL_DIR</span><span class="hljs-string">" ]
  then
    echo "</span>Found same AWS CLI version: <span class="hljs-variable">$INSTALL_DIR</span>. Skipping install.<span class="hljs-string">"
    exit 0
  fi
}

setup_install_dist() {
  cp -r "</span><span class="hljs-variable">$INSTALLER_DIST_DIR</span><span class="hljs-string">" "</span><span class="hljs-variable">$INSTALL_DIST_DIR</span><span class="hljs-string">"
}

setup_install_bin() {
  mkdir -p "</span><span class="hljs-variable">$INSTALL_BIN_DIR</span><span class="hljs-string">"
  ln -s "</span>../dist/<span class="hljs-variable">$EXE_NAME</span><span class="hljs-string">" "</span><span class="hljs-variable">$INSTALL_AWS_EXE</span><span class="hljs-string">"
  ln -s "</span>../dist/<span class="hljs-variable">$COMPLETER_EXE_NAME</span><span class="hljs-string">" "</span><span class="hljs-variable">$INSTALL_AWS_COMPLETER_EXE</span><span class="hljs-string">"
}

create_current_symlink() {
  ln -snf "</span><span class="hljs-variable">$INSTALL_DIR</span><span class="hljs-string">" "</span><span class="hljs-variable">$CURRENT_INSTALL_DIR</span><span class="hljs-string">"
}

create_bin_symlinks() {
  mkdir -p "</span><span class="hljs-variable">$BIN_DIR</span><span class="hljs-string">"
  ln -sf "</span><span class="hljs-variable">$CURRENT_AWS_EXE</span><span class="hljs-string">" "</span><span class="hljs-variable">$BIN_AWS_EXE</span><span class="hljs-string">"
  ln -sf "</span><span class="hljs-variable">$CURRENT_AWS_COMPLETER_EXE</span><span class="hljs-string">" "</span><span class="hljs-variable">$BIN_AWS_COMPLETER_EXE</span><span class="hljs-string">"
}

die() {
	err_msg="</span><span class="hljs-variable">$1</span><span class="hljs-string">"
	echo "</span><span class="hljs-variable">$err_msg</span><span class="hljs-string">" &gt;&amp;2
	exit 1
}

main() {
  parse_commandline "</span><span class="hljs-variable">$@</span><span class="hljs-string">"
  set_global_vars
  check_preexisting_install
  create_install_dir
  create_bin_symlinks
  echo "</span>You can now run: <span class="hljs-variable">$BIN_AWS_EXE</span> --version<span class="hljs-string">"
  exit 0
}

main "</span><span class="hljs-variable">$@</span><span class="hljs-string">" || exit 1

</span></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
